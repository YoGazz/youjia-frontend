# ğŸš€ TestPro åç«¯æ¥å…¥æŒ‡å—

## ğŸ“š ç›®å½•
1. [åŸºç¡€æ¦‚å¿µ](#åŸºç¡€æ¦‚å¿µ)
2. [å½“å‰é¡¹ç›®çŠ¶æ€](#å½“å‰é¡¹ç›®çŠ¶æ€)
3. [æ¥å…¥æ­¥éª¤](#æ¥å…¥æ­¥éª¤)
4. [é…ç½®ä¿®æ”¹](#é…ç½®ä¿®æ”¹)
5. [APIæ¥å£å¯¹æ¥](#apiæ¥å£å¯¹æ¥)
6. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
7. [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ§  åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯APIæ¥å£ï¼Ÿ
APIï¼ˆApplication Programming Interfaceï¼‰æ˜¯å‰ç«¯å’Œåç«¯ä¹‹é—´çš„"æ¡¥æ¢"ï¼š

```
å‰ç«¯é¡µé¢ â†â†’ APIæ¥å£ â†â†’ åç«¯æœåŠ¡å™¨ â†â†’ æ•°æ®åº“
   â†“           â†“           â†“           â†“
ç”¨æˆ·æ“ä½œ    HTTPè¯·æ±‚    ä¸šåŠ¡é€»è¾‘    æ•°æ®å­˜å‚¨
```

### HTTPè¯·æ±‚æ–¹æ³•
- **GET**: è·å–æ•°æ®ï¼ˆæŸ¥è¯¢ï¼‰
- **POST**: åˆ›å»ºæ•°æ®ï¼ˆæ–°å¢ï¼‰
- **PUT**: æ›´æ–°æ•°æ®ï¼ˆä¿®æ”¹ï¼‰
- **DELETE**: åˆ é™¤æ•°æ®
- **PATCH**: éƒ¨åˆ†æ›´æ–°æ•°æ®

### è¯·æ±‚å’Œå“åº”æ ¼å¼
```javascript
// è¯·æ±‚ç¤ºä¾‹
POST /api/auth/login
Content-Type: application/json
{
  "username": "admin",
  "password": "123456"
}

// å“åº”ç¤ºä¾‹
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com"
    }
  }
}
```

## ğŸ“‹ å½“å‰é¡¹ç›®çŠ¶æ€

### ç°æœ‰é…ç½®
é¡¹ç›®å·²ç»é…ç½®å¥½äº†åŸºç¡€çš„APIç»“æ„ï¼š

1. **APIé…ç½®æ–‡ä»¶**: `src/api/request.ts` - HTTPå®¢æˆ·ç«¯é…ç½®
2. **æ¥å£å®šä¹‰**: `src/api/index.ts` - å…·ä½“çš„APIæ¥å£
3. **ç±»å‹å®šä¹‰**: `src/types/api.ts` - TypeScriptç±»å‹
4. **æ¨¡æ‹Ÿåç«¯**: `mock/server.js` - å¼€å‘ç”¨çš„å‡æ•°æ®

### å½“å‰ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®
- å‰ç«¯è¯·æ±‚ â†’ Viteä»£ç† â†’ æ¨¡æ‹Ÿåç«¯ â†’ è¿”å›å‡æ•°æ®
- æ¨¡æ‹Ÿåç«¯åœ°å€ï¼šhttp://localhost:8081

## ğŸ¯ æ¥å…¥æ­¥éª¤

### æ­¥éª¤1ï¼šè·å–åç«¯ä¿¡æ¯

é¦–å…ˆï¼Œæ‚¨éœ€è¦ä»åç«¯å¼€å‘è€…é‚£é‡Œè·å–ä»¥ä¸‹ä¿¡æ¯ï¼š

#### å¿…éœ€ä¿¡æ¯
- **åç«¯æœåŠ¡å™¨åœ°å€**: å¦‚ `https://api.testpro.com` æˆ– `http://192.168.1.100:8080`
- **APIæ–‡æ¡£**: æ¥å£åœ°å€ã€å‚æ•°æ ¼å¼ã€å“åº”æ ¼å¼
- **è®¤è¯æ–¹å¼**: Tokenã€API Keyç­‰
- **ç¯å¢ƒä¿¡æ¯**: å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒåœ°å€

#### APIæ–‡æ¡£ç¤ºä¾‹
```
åŸºç¡€åœ°å€: https://api.testpro.com
è®¤è¯æ–¹å¼: Bearer Token

æ¥å£åˆ—è¡¨:
POST /api/auth/login     - ç”¨æˆ·ç™»å½•
POST /api/auth/register  - ç”¨æˆ·æ³¨å†Œ
GET  /api/users         - è·å–ç”¨æˆ·åˆ—è¡¨
POST /api/users         - åˆ›å»ºç”¨æˆ·
PUT  /api/users/:id     - æ›´æ–°ç”¨æˆ·
DELETE /api/users/:id   - åˆ é™¤ç”¨æˆ·
```

### æ­¥éª¤2ï¼šä¿®æ”¹APIé…ç½®

#### 2.1 ä¿®æ”¹åŸºç¡€URL
ç¼–è¾‘ `src/api/request.ts` æ–‡ä»¶ï¼š

```typescript
// å½“å‰é…ç½®ï¼ˆä½¿ç”¨ä»£ç†ï¼‰
const api: AxiosInstance = axios.create({
  baseURL: '/api', // ä»£ç†åˆ°æ¨¡æ‹Ÿåç«¯
  timeout: 10000,
})

// ä¿®æ”¹ä¸ºçœŸå®åç«¯åœ°å€
const api: AxiosInstance = axios.create({
  baseURL: 'https://api.testpro.com', // çœŸå®åç«¯åœ°å€
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})
```

#### 2.2 ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰
åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶æ¥ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ï¼š

**åˆ›å»º `.env.development` æ–‡ä»¶**ï¼š
```
# å¼€å‘ç¯å¢ƒ
VITE_API_BASE_URL=http://localhost:8080/api
VITE_APP_TITLE=TestProå¼€å‘ç¯å¢ƒ
```

**åˆ›å»º `.env.production` æ–‡ä»¶**ï¼š
```
# ç”Ÿäº§ç¯å¢ƒ
VITE_API_BASE_URL=https://api.testpro.com/api
VITE_APP_TITLE=TestPro
```

**ä¿®æ”¹ `src/api/request.ts`**ï¼š
```typescript
const api: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})
```

### æ­¥éª¤3ï¼šå¯¹æ¥å…·ä½“æ¥å£

#### 3.1 ç¡®è®¤æ¥å£æ ¼å¼
ä¸åç«¯å¼€å‘è€…ç¡®è®¤æ¯ä¸ªæ¥å£çš„å…·ä½“æ ¼å¼ï¼š

```typescript
// ç¤ºä¾‹ï¼šç™»å½•æ¥å£å¯¹æ¥
// åç«¯æ–‡æ¡£è¯´æ˜ï¼š
// POST /api/auth/login
// è¯·æ±‚å‚æ•°: { username: string, password: string }
// å“åº”æ ¼å¼: { code: number, message: string, data: { token: string, user: object } }

export const authApi = {
  login: (data: LoginRequest): Promise<ApiResponse<LoginResponse>> => {
    return api.post('/auth/login', data)
  }
}
```

#### 3.2 è°ƒæ•´ç±»å‹å®šä¹‰
æ ¹æ®åç«¯å®é™…è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œä¿®æ”¹ `src/types/api.ts`ï¼š

```typescript
// æ ¹æ®åç«¯å®é™…å“åº”æ ¼å¼è°ƒæ•´
export interface ApiResponse<T = any> {
  code: number        // åç«¯è¿”å›çš„çŠ¶æ€ç 
  message: string     // åç«¯è¿”å›çš„æ¶ˆæ¯
  data: T            // å®é™…æ•°æ®
  timestamp?: string  // æ—¶é—´æˆ³ï¼ˆå¦‚æœåç«¯æœ‰ï¼‰
}

export interface LoginResponse {
  token: string
  user: User
  expiresIn?: number  // tokenè¿‡æœŸæ—¶é—´ï¼ˆå¦‚æœåç«¯æœ‰ï¼‰
}
```

### æ­¥éª¤4ï¼šå¤„ç†è·¨åŸŸé—®é¢˜

#### 4.1 å¼€å‘ç¯å¢ƒï¼ˆä½¿ç”¨ä»£ç†ï¼‰
å¦‚æœåç«¯ä¸æ”¯æŒè·¨åŸŸï¼Œåœ¨å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨Viteä»£ç†ã€‚

ä¿®æ”¹ `vite.config.ts`ï¼š
```typescript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080', // åç«¯åœ°å€
        changeOrigin: true,
        secure: false,
        // rewrite: (path) => path.replace(/^\/api/, '') // å¦‚æœéœ€è¦å»æ‰/apiå‰ç¼€
      }
    }
  }
})
```

#### 4.2 ç”Ÿäº§ç¯å¢ƒ
ç”Ÿäº§ç¯å¢ƒéœ€è¦åç«¯é…ç½®CORSï¼Œæˆ–è€…ä½¿ç”¨Nginxç­‰åå‘ä»£ç†ã€‚

### æ­¥éª¤5ï¼šæ›´æ–°è®¤è¯é€»è¾‘

#### 5.1 Tokenå¤„ç†
ç¡®è®¤åç«¯çš„Tokenæ ¼å¼å’Œä½¿ç”¨æ–¹å¼ï¼š

```typescript
// åœ¨ request.ts çš„è¯·æ±‚æ‹¦æˆªå™¨ä¸­
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    // ç¡®è®¤åç«¯éœ€è¦çš„Tokenæ ¼å¼
    config.headers.Authorization = `Bearer ${token}` // æˆ–è€…å…¶ä»–æ ¼å¼
  }
  return config
})
```

#### 5.2 é”™è¯¯å¤„ç†
æ ¹æ®åç«¯çš„é”™è¯¯ç è°ƒæ•´é”™è¯¯å¤„ç†é€»è¾‘ï¼š

```typescript
// åœ¨ request.ts çš„å“åº”æ‹¦æˆªå™¨ä¸­
api.interceptors.response.use(
  (response) => {
    // æ ¹æ®åç«¯çš„æˆåŠŸæ ‡è¯†åˆ¤æ–­
    if (response.data.code === 200) {
      return response.data
    } else {
      // å¤„ç†ä¸šåŠ¡é”™è¯¯
      return Promise.reject(new Error(response.data.message))
    }
  },
  (error) => {
    // å¤„ç†HTTPé”™è¯¯
    if (error.response?.status === 401) {
      // Tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•
      localStorage.removeItem('token')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)
```

## ğŸ”§ å®é™…æ“ä½œç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¯¹æ¥ç™»å½•æ¥å£

#### åç«¯æ¥å£æ–‡æ¡£
```
POST /api/auth/login
è¯·æ±‚å‚æ•°:
{
  "username": "string",
  "password": "string"
}

å“åº”æ ¼å¼:
{
  "success": true,
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin"
    }
  }
}
```

#### å‰ç«¯ä»£ç è°ƒæ•´

**1. æ›´æ–°ç±»å‹å®šä¹‰ (`src/types/api.ts`)**ï¼š
```typescript
export interface ApiResponse<T = any> {
  success: boolean
  code: number
  message: string
  data: T
}

export interface LoginResponse {
  accessToken: string  // æ³¨æ„ï¼šåç«¯è¿”å›çš„æ˜¯accessTokenï¼Œä¸æ˜¯token
  user: User
}
```

**2. æ›´æ–°APIæ¥å£ (`src/api/index.ts`)**ï¼š
```typescript
export const authApi = {
  login: (data: LoginRequest): Promise<ApiResponse<LoginResponse>> => {
    return api.post('/auth/login', data)
  }
}
```

**3. æ›´æ–°ç™»å½•é€»è¾‘ (`src/stores/auth.ts`)**ï¼š
```typescript
const login = async (loginData: LoginRequest) => {
  try {
    isLoading.value = true
    const response = await authApi.login(loginData)
    
    // æ ¹æ®åç«¯å®é™…è¿”å›çš„å­—æ®µåè°ƒæ•´
    const { accessToken, user } = response.data
    
    // ä¿å­˜tokenï¼ˆæ³¨æ„å­—æ®µåï¼‰
    localStorage.setItem('token', accessToken)
    localStorage.setItem('user', JSON.stringify(user))
    
    // æ›´æ–°çŠ¶æ€
    token.value = accessToken
    currentUser.value = user
    
    return response
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error)
    throw error
  } finally {
    isLoading.value = false
  }
}
```

**4. æ›´æ–°è¯·æ±‚æ‹¦æˆªå™¨ (`src/api/request.ts`)**ï¼š
```typescript
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    // ç¡®è®¤åç«¯éœ€è¦çš„Tokenæ ¼å¼
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

### ç¤ºä¾‹2ï¼šå¯¹æ¥ç”¨æˆ·åˆ—è¡¨æ¥å£

#### åç«¯æ¥å£æ–‡æ¡£
```
GET /api/users?page=1&size=10&keyword=admin
å“åº”æ ¼å¼:
{
  "success": true,
  "code": 200,
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "size": 10
  }
}
```

#### å‰ç«¯ä»£ç è°ƒæ•´

**1. æ›´æ–°ç±»å‹å®šä¹‰**ï¼š
```typescript
export interface PageResponse<T> {
  list: T[]      // æ³¨æ„ï¼šåç«¯è¿”å›çš„æ˜¯listï¼Œä¸æ˜¯items
  total: number
  page: number
  size: number
}
```

**2. æ›´æ–°APIæ¥å£**ï¼š
```typescript
export const userApi = {
  getAllUsers: (params?: {
    page?: number
    size?: number
    keyword?: string
  }): Promise<ApiResponse<PageResponse<User>>> => {
    return api.get('/users', { params })
  }
}
```

**3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨**ï¼š
```typescript
// åœ¨ UserManagement.vue ä¸­
const fetchUsers = async () => {
  try {
    loading.value = true
    const response = await userApi.getAllUsers({
      page: currentPage.value,
      size: pageSize.value,
      keyword: searchKeyword.value
    })
    
    // æ ¹æ®åç«¯å®é™…è¿”å›çš„æ•°æ®ç»“æ„è°ƒæ•´
    const { list, total } = response.data
    users.value = list
    totalUsers.value = total
    
  } catch (error) {
    ElMessage.error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

## ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šè·¨åŸŸé”™è¯¯
```
Access to XMLHttpRequest at 'https://api.testpro.com/api/auth/login' 
from origin 'http://localhost:3000' has been blocked by CORS policy
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨Viteä»£ç†
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šè®©åç«¯é…ç½®CORS
3. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šä½¿ç”¨æµè§ˆå™¨æ’ä»¶ç¦ç”¨CORSï¼ˆä»…å¼€å‘æ—¶ï¼‰

### é—®é¢˜2ï¼šTokenæ ¼å¼é”™è¯¯
```
401 Unauthorized: Invalid token format
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®è®¤åç«¯éœ€è¦çš„Tokenæ ¼å¼ï¼š
- `Bearer ${token}`
- `Token ${token}`
- ç›´æ¥ä¼ é€’tokenå€¼

### é—®é¢˜3ï¼šæ•°æ®æ ¼å¼ä¸åŒ¹é…
```
TypeError: Cannot read property 'data' of undefined
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯å®é™…è¿”å›çš„æ•°æ®ç»“æ„
2. æ›´æ–°TypeScriptç±»å‹å®šä¹‰
3. è°ƒæ•´å‰ç«¯ä»£ç ä¸­çš„æ•°æ®è®¿é—®æ–¹å¼

### é—®é¢˜4ï¼šç½‘ç»œè¯·æ±‚è¶…æ—¶
```
timeout of 10000ms exceeded
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ è¶…æ—¶æ—¶é—´
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç¡®è®¤åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸

## âœ… æµ‹è¯•éªŒè¯

### 1. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. æ‰“å¼€F12å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. æ‰§è¡Œç™»å½•æ“ä½œ
4. æŸ¥çœ‹è¯·æ±‚å’Œå“åº”

### 2. ä½¿ç”¨Postmanæµ‹è¯•
åœ¨å¯¹æ¥å‰ç«¯ä¹‹å‰ï¼Œå…ˆç”¨Postmanæµ‹è¯•åç«¯æ¥å£ï¼š
```
POST https://api.testpro.com/api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "123456"
}
```

### 3. é€æ­¥æµ‹è¯•
1. å…ˆæµ‹è¯•ç™»å½•æ¥å£
2. å†æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£
3. æœ€åæµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹

## ğŸ“ æ£€æŸ¥æ¸…å•

æ¥å…¥åç«¯å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] è·å¾—åç«¯APIæ–‡æ¡£
- [ ] ç¡®è®¤åç«¯æœåŠ¡å™¨åœ°å€
- [ ] äº†è§£è®¤è¯æ–¹å¼å’ŒTokenæ ¼å¼
- [ ] ç¡®è®¤æ•°æ®æ ¼å¼å’Œå­—æ®µå
- [ ] é…ç½®å¼€å‘ç¯å¢ƒä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ›´æ–°APIåŸºç¡€URL
- [ ] è°ƒæ•´ç±»å‹å®šä¹‰
- [ ] æ›´æ–°é”™è¯¯å¤„ç†é€»è¾‘
- [ ] æµ‹è¯•ç™»å½•åŠŸèƒ½
- [ ] æµ‹è¯•å…¶ä»–æ¥å£
- [ ] å¤„ç†è·¨åŸŸé—®é¢˜

## ğŸ¯ ä¸‹ä¸€æ­¥

æ¥å…¥åç«¯åï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦ï¼š

1. **ä¼˜åŒ–é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€é”™è¯¯æç¤ºå’Œå¤„ç†
2. **æ·»åŠ åŠ è½½çŠ¶æ€**ï¼šæå‡ç”¨æˆ·ä½“éªŒ
3. **å®ç°æ•°æ®ç¼“å­˜**ï¼šå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚
4. **æ·»åŠ è¯·æ±‚é‡è¯•**ï¼šæé«˜ç¨³å®šæ€§
5. **ç›‘æ§å’Œæ—¥å¿—**ï¼šä¾¿äºé—®é¢˜æ’æŸ¥

---

**ğŸ’¡ æç¤ºï¼šæ¥å…¥åç«¯æ˜¯ä¸€ä¸ªé€æ­¥çš„è¿‡ç¨‹ï¼Œå»ºè®®å…ˆä»ç™»å½•æ¥å£å¼€å§‹ï¼Œç¡®ä¿åŸºç¡€åŠŸèƒ½æ­£å¸¸åå†é€æ­¥å¯¹æ¥å…¶ä»–æ¥å£ã€‚**
